image: node:24

definitions:
  caches:
    pnpm: $HOME/.local/share/pnpm/store

  steps:
    - step: &lint
        name: Lint & Type Check
        caches:
          - pnpm
        script:
          - corepack enable
          - corepack prepare pnpm@latest --activate
          - pnpm install --frozen-lockfile
          - pnpm lint
          - pnpm format:check
          - pnpm typecheck

    - step: &test
        name: Test & Coverage
        caches:
          - pnpm
        script:
          - corepack enable
          - corepack prepare pnpm@latest --activate
          - pnpm install --frozen-lockfile
          - pnpm test:coverage

    # Python lint step - uncomment for Python projects
    # - step: &lint-python
    #     name: Lint Python
    #     image: python:3.13
    #     script:
    #       - pip install uv
    #       - uv sync --dev
    #       - uv run ruff check .
    #       - uv run ruff format --check .
    #       - uv run mypy src/
    #
    # - step: &test-python
    #     name: Test Python & Coverage
    #     image: python:3.13
    #     script:
    #       - pip install uv
    #       - uv sync --dev
    #       - uv run pytest --cov=src --cov-fail-under=80 --cov-report=xml

    # Optional: Go lint step
    # - step: &lint-go
    #     name: Lint Go
    #     image: golang:1.22
    #     script:
    #       - curl -sSfL https://raw.githubusercontent.com/golangci/golangci-lint/master/install.sh | sh -s -- -b $(go env GOPATH)/bin
    #       - golangci-lint run

pipelines:
  default:
    - step: *lint
    - step: *test

  pull-requests:
    '**':
      - step: *lint
      - step: *test

  branches:
    main:
      - step: *lint
      - step: *test
    master:
      - step: *lint
      - step: *test
    develop:
      - step: *lint
      - step: *test

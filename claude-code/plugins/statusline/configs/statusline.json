{
  "statusLine": {
    "type": "command",
    "command": "input=$(cat); current_dir=$(pwd); git_branch=$(git branch --show-current 2>/dev/null); model=$(echo \"$input\" | jq -r '.model.display_name // \"?\"'); context_size=$(echo \"$input\" | jq -r '.context_window.context_window_size // 200000'); current_usage=$(echo \"$input\" | jq '.context_window.current_usage // null'); if [ \"$current_usage\" != \"null\" ]; then ctx_raw=$(echo \"$current_usage\" | jq '(.input_tokens // 0) + (.output_tokens // 0) + (.cache_creation_input_tokens // 0) + (.cache_read_input_tokens // 0)'); ctx_tokens=$((ctx_raw + 45000)); ctx_pct=$((ctx_tokens * 100 / context_size)); ctx_k=$((ctx_tokens / 1000)); size_k=$((context_size / 1000)); ctx_str=\"ğŸ§  ${ctx_k}k/${size_k}k (${ctx_pct}%)\"; else ctx_str=\"ğŸ§  0k/200k (0%)\"; fi; now=$(date +%s); ccusage_cache=\"/tmp/claude-ccusage-cache.json\"; refresh_ccusage() { today=$(date +%Y-%m-%d); daily=$(ccusage daily -j 2>/dev/null | jq -r '.daily[] | select(.date == \"'$today'\") | .totalCost // 0'); block=$(ccusage blocks -j 2>/dev/null | jq -r '.blocks[] | select(.isActive == true) | .costUSD // 0'); echo \"{\\\"daily\\\":\\\"${daily:-0}\\\",\\\"block\\\":\\\"${block:-0}\\\"}\" > \"$ccusage_cache\"; }; if [ -f \"$ccusage_cache\" ]; then file_ts=$(stat -f %m \"$ccusage_cache\" 2>/dev/null || echo 0); age=$((now - file_ts)); [ \"$age\" -gt 60 ] && refresh_ccusage; else refresh_ccusage; fi; daily_fmt=$(printf '%.2f' \"$(jq -r '.daily // 0' \"$ccusage_cache\" 2>/dev/null)\"); block_fmt=$(printf '%.2f' \"$(jq -r '.block // 0' \"$ccusage_cache\" 2>/dev/null)\"); oauth_cache=\"/tmp/claude-usage-cache.json\"; refresh_oauth() { token=$(security find-generic-password -s \"Claude Code-credentials\" -w 2>/dev/null | jq -r '.claudeAiOauth.accessToken // empty'); if [ -n \"$token\" ]; then curl -s \"https://api.anthropic.com/api/oauth/usage\" -H \"Authorization: Bearer $token\" -H \"anthropic-beta: oauth-2025-04-20\" 2>/dev/null > \"$oauth_cache\"; fi; }; if [ -f \"$oauth_cache\" ]; then file_ts=$(stat -f %m \"$oauth_cache\" 2>/dev/null || echo 0); age=$((now - file_ts)); [ \"$age\" -gt 60 ] && refresh_oauth; else refresh_oauth; fi; reset_at=$(jq -r '.five_hour.resets_at // empty' \"$oauth_cache\" 2>/dev/null); time_left=\"\"; if [ -n \"$reset_at\" ]; then reset_ts=\"${reset_at:0:19}\"; reset_epoch=$(date -j -u -f \"%Y-%m-%dT%H:%M:%S\" \"$reset_ts\" +%s 2>/dev/null); if [ -n \"$reset_epoch\" ]; then now_utc=$(date -u +%s); remaining=$((reset_epoch - now_utc)); if [ \"$remaining\" -gt 0 ]; then hrs=$((remaining / 3600)); mins=$(((remaining % 3600) / 60)); time_left=\" (${hrs}h ${mins}m)\"; fi; fi; fi; cost_str=\"ğŸ’° \\$$daily_fmt today / \\$$block_fmt block$time_left\"; five_hr=$(jq -r '.five_hour.utilization // 0' \"$oauth_cache\" 2>/dev/null | xargs printf '%.0f'); seven_day=$(jq -r '.seven_day.utilization // 0' \"$oauth_cache\" 2>/dev/null | xargs printf '%.0f'); sonnet=$(jq -r '.seven_day_sonnet.utilization // 0' \"$oauth_cache\" 2>/dev/null | xargs printf '%.0f'); echo \"$now,$five_hr,$seven_day,$sonnet\" >> /tmp/claude-usage-log.csv; usage_str=\"ğŸ“Š 5h: ${five_hr}% / 7d: ${seven_day}% / son: ${sonnet}%\"; if [ -n \"$git_branch\" ]; then printf \"%s â”‚ %s â”‚ ğŸ¤– %s | %s | %s | %s\" \"$(basename \"$current_dir\")\" \"$git_branch\" \"$model\" \"$cost_str\" \"$ctx_str\" \"$usage_str\"; else printf \"%s â”‚ ğŸ¤– %s | %s | %s | %s\" \"$(basename \"$current_dir\")\" \"$model\" \"$cost_str\" \"$ctx_str\" \"$usage_str\"; fi",
    "padding": 0
  }
}
